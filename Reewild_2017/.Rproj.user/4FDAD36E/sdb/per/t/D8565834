{
    "collab_server" : "",
    "contents" : "# open libs\nlibrary(ggplot2)\nlibrary(INBOtheme)\nlibrary(plyr)\nlibrary(functional)\nlibrary(reshape2)\nlibrary(scales)\nlibrary(gridExtra)\nlibrary(sqldf)\nlibrary(reshape)\nlibrary(RODBC)\n\nsetwd(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild\")\n\n# 1. Gegevens ophalen\n# --------------------------------------------------------------------------------------------------------------------------\n\n#maak verbinding\nverbinding <- odbcDriverConnect(\"DRIVER=SQL Server; Server=INBOSQL03\\\\PRD; Database=D0106pr00_Autopsie\")\n\nsqlTables(\n  verbinding,\n  schema = \"dbo\",\n  tableType = \"TABLE\"\n)$TABLE_NAME\n\n# Haal relevante tabellen op:\n\n# voor de meldingsformulieren grofwild:\ndbo_Meldingsformulier <- sqlFetch(verbinding, \"dbo.Meldingsformulier\")\ndbo_Groep <- sqlFetch(verbinding, \"dbo.Groep\")\ndbo_Leeftijd <- sqlFetch(verbinding, \"dbo.Leeftijd\")\ndbo_Geslacht <- sqlFetch(verbinding, \"dbo.Geslacht\")\ndbo_Jachtmethode <- sqlFetch(verbinding, \"dbo.Jachtmethode\")\ndbo_WettelijkKader <- sqlFetch(verbinding, \"dbo.WettelijkKader\")\ndbo_Eloket <- sqlFetch(verbinding, \"dbo.Eloket\")\n\n#dbo_Diersoort <- sqlFetch(verbinding, \"dbo.Diersoort\")\n#dbo_DierTelling <- sqlFetch(verbinding, \"dbo.DierTelling\")\n#dbo_Provincie <- sqlFetch(verbinding, \"dbo.Provincie\")\ndbo_Rapport <- sqlFetch(verbinding, \"dbo.Rapport\")\ndbo_RapportStatus <- sqlFetch(verbinding, \"dbo.RapportStatus\")\n#dbo_Telling <- sqlFetch(verbinding, \"dbo.Telling\")\n#dbo_TellingType <- sqlFetch(verbinding, \"dbo.TellingType\")\n#dbo_WildBeheerEenheid <- sqlFetch(verbinding, \"dbo.WildBeheerEenheid\")\n#dbo_Hoedanigheid <- sqlFetch(verbinding, \"dbo.Hoedanigheid\")\n#dbo_Land <- sqlFetch(verbinding, \"dbo.Land\")\n#dbo_Indiener <- sqlFetch(verbinding, \"dbo.Indiener\")\n\n# voor de identificaties grofwild:\ndbo_Identificatie <- sqlFetch(verbinding, \"dbo.Identificatie\")\ndbo_Staal <- sqlFetch(verbinding, \"dbo.Staal\")\ndbo_Leeftijd <- sqlFetch(verbinding, \"dbo.Leeftijd\")\ndbo_Geslacht <- sqlFetch(verbinding, \"dbo.Geslacht\")\ndbo_Diersoort <- sqlFetch(verbinding, \"dbo.Diersoort\")\ndbo_Doodsoorzaak <- sqlFetch(verbinding, \"dbo.Doodsoorzaak\")\ndbo_Vindplaats <- sqlFetch(verbinding, \"dbo.Vindplaats\")\ndbo_Onderkaak <- sqlFetch(verbinding, \"dbo.Onderkaak\")\n\n# sluit de verbinding\nodbcClose(verbinding)\nremove(verbinding)\n\n#2. Gegevens opkuisen\n#-----------------------------------------------------------------------------------------------------------------\n\n##Versie=NA is ingegeven door Erik, maar krijgen ook LaatsteVersi=1, dus filter op LaatsteVersie\nMeldingen <- subset(dbo_Meldingsformulier, LaatsteVersie==1)\nMeldingen <- merge(Meldingen, dbo_Eloket, by.x=\"ID\", by.y=\"MeldingsformulierID\", all.x=TRUE)\n##RapportStatus 3 en 4 zitten er niet meer in, wel nog NA's, die mogen 2 worden\nMeldingen$RapportStatusID[is.na(Meldingen$RapportStatusID)] <- 5\nMeldingen <- subset(Meldingen, RapportStatusID!=1)\n##Enkel Ree\nMeldingen <-subset(Meldingen, DiersoortID==5)\n##Controle afschotdatum en jaar labelnummer komen overeen?\ncontrole <- Meldingen\ncontrole$test <- substr(controle$LabelNummer,5,8)\ncontrole$test2 <- as.character(controle$AfschotDatum, \"%Y\")\ncontrole$test <- as.numeric(controle$test)\ncontrole$test2 <- as.numeric(controle$test2)\ncontrole$test3 <- controle$test-controle$test2\ntable(controle$test3)\nfouten <- subset(controle, test3!=0)\nremove(controle)\n\nMeldingen$Jaar <- as.character(Meldingen$AfschotDatum, \"%Y\")\n\n# Data omzetten naar namen in script\nMeldingen$Registernr <- Meldingen$NummerAfschotplan\nMeldingen$Provincie <- \"Limburg\"\nMeldingen$Provincie[substr(Meldingen$Registernr,1,2)==\"AN\"] <- \"Antwerpen\"\nMeldingen$Provincie[substr(Meldingen$Registernr,1,2)==\"VB\"] <- \"Vlaams-Brabant\"\nMeldingen$Provincie[substr(Meldingen$Registernr,1,2)==\"WV\"] <- \"West-Vlaanderen\"\nMeldingen$Provincie[substr(Meldingen$Registernr,1,2)==\"OV\"] <- \"Oost-Vlaanderen\"\nMeldingen$Labelnummer <- Meldingen$LabelNummer\nMeldingen$Jaar <- factor(Meldingen$Jaar)\nMeldingen$Labeltype <- substr(Meldingen$LabelNummer,13,13)\nMeldingen$Labeltype[Meldingen$Labeltype==\"B\"] <- \"Bokken\"\nMeldingen$Labeltype[Meldingen$Labeltype==\"G\"] <- \"Geiten\"\nMeldingen$Labeltype[Meldingen$Labeltype==\"K\"] <- \"Kitsen\"\nMeldingen$Datum <- as.Date(Meldingen$AfschotDatum, \"%d/%m/%Y\")\nMeldingen$Type <- \"Geit\"\nMeldingen$Type[Meldingen$GeslachtID==1 & Meldingen$LeeftijdID==17] <- \"Bokkits\"\nMeldingen$Type[Meldingen$GeslachtID==1 & Meldingen$LeeftijdID==18] <- \"Jaarlingbok\"\nMeldingen$Type[Meldingen$GeslachtID==1 & Meldingen$LeeftijdID==19] <- \"Bok\"\nMeldingen$Type[Meldingen$GeslachtID==2 & Meldingen$LeeftijdID==17] <- \"Geitkits\"\nMeldingen$Type[Meldingen$GeslachtID==2 & Meldingen$LeeftijdID==18] <- \"Smalree\"\nMeldingen$Type <- factor(Meldingen$Type, levels=c(\"Bokkits\",\"Geitkits\",\"Jaarlingbok\",\"Smalree\",\"Bok\",\"Geit\"))\nMeldingen$Gewicht <- Meldingen$OntweidGewicht\nMeldingen$OKG <- rowMeans(subset(Meldingen, select = c(OnderkaaklengteLinks, OnderkaaklengteRechts)), na.rm = TRUE)\nMeldingen$TotEmbryo <- Meldingen$AantalEmbryos\n\n##Overzicht wegschrijven voor analyses Afzonderlijk\ntmp <- Meldingen[,c(8,15,46)]\ntmp$Type2[tmp$Type==\"Bokkits\"] <- \"RK\"\ntmp$Type2[tmp$Type==\"Geitkits\"] <- \"RK\"\ntmp$Type2[tmp$Type==\"Geit\"] <- \"RG\"\ntmp$Type2[tmp$Type==\"Smalree\"] <- \"RG\"\ntmp$Type2[tmp$Type==\"Bok\"] <- \"RB\"\ntmp$Type2[tmp$Type==\"Jaarlingbok\"] <- \"RB\"\ntmp$Type2 <- factor(tmp$Type2)\ntmp2 <- ddply(tmp, c(\"NummerAfschotplan\",\"Type2\"), summarise,\n              value=length(LabelNummer))\ntmp2 <- cast(tmp2, NummerAfschotplan~Type2, sum)\nsetwd(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/R/2016\")\nwrite.csv(tmp2, file=\"Meldingen_2016.csv\")\nremove(tmp, tmp2)\n\n##Jaren tussen 2013 en huidig jaar apart houden voor vergelijking met voorbije jaren\nMeldingen2015  <- subset(Meldingen, Jaar==2014|Jaar==2015)\n##Vanaf hier gaan we verder met enkel 2015\nMeldingen <- subset(Meldingen, Jaar==2016)\n\nDubbels <-as.data.frame(table(Meldingen$LabelNummer))\nDubbels <- subset(Dubbels, Freq>1)\nnames(Dubbels)[names(Dubbels)==\"Var1\"] <- \"LabelNummer\"\nDubbels <- merge(Dubbels,Meldingen, by=\"LabelNummer\", all.x=TRUE)\nDubbels <- Dubbels[c(1,2,10)]\n\n###Overzichtstabel 2015 voor WBE's\ntabel <- ddply(Meldingen, c(\"NummerAfschotplan\",\"Type\"), summarise,\n               Aantal = length(Labelnummer))\ntabel <- cast(tabel, NummerAfschotplan~Type)\ntabel$Totaal <- rowSums(tabel, na.rm=TRUE)\nwrite.csv(tabel, file=\"Afschot_WBEs_2016.csv\")\n\nMeldingen$controlejaar <- substr(Meldingen$NummerAfschotplan, 7,10)\ncontrole <- subset(Meldingen, controlejaar!=2015)\ncontrole <- controle[c(8:12,15)]\nMeldingen$controlenummer <- substr(Meldingen$NummerAfschotplan, 12,15)\nMeldingen$controlenummer <- as.numeric(Meldingen$controlenummer)\ncontrole <- subset(Meldingen, controlenummer>100)\ncontrole <- controle[c(8:12,15)]\n\n\nremove(Dubbels)\nMeldingen2015 <- Meldingen2015[c(40:49, 11)]\nMeldingen2016 <- Meldingen[c(40:49, 11)]\n\n##Inladen gegevens jaren tot en met 2013\nMeldingen2013 <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/Meldingen_voorbijejaren_postcode.csv\",sep=\";\", dec=\",\")\nMeldingen2013$Jaar <- factor(Meldingen2013$Jaar)\nMeldingen2013$Datum <- as.Date(Meldingen2013$Datum, \"%d/%m/%Y\")\nMeldingen2013$Type <- factor(Meldingen2013$Type)\n\nMeldingenAll <- rbind(Meldingen2013,Meldingen2015, Meldingen2016)\n\nMeldingenAll$Maand <- as.numeric(format(MeldingenAll$Datum, format = \"%m\"))\nMeldingenAll$Dag <- as.numeric(format(MeldingenAll$Datum, format = \"%d\"))\nwrite.csv(MeldingenAll, file=\"MeldingenAll.csv\")\n\n\n######GESCHOTEN OP#######\nd <- subset(MeldingenAll, Labeltype==\"Bokken\"|Labeltype==\"Geiten\"|Labeltype==\"Kitsen\")\nd <- subset(d, Maand>0)\n\nd$Maand <- as.factor(d$Maand)\nd$Bin <- NA\nd$Bin[d$Maand==1 & d$Dag <= 15] <- 1\nd$Bin[d$Maand==1 & d$Dag > 15] <- 2\nd$Bin[d$Maand==2 & d$Dag <= 14] <- 3\nd$Bin[d$Maand==2 & d$Dag > 14] <- 4\nd$Bin[d$Maand==3 & d$Dag <= 15] <- 5\nd$Bin[d$Maand==3 & d$Dag > 15] <- 6\nd$Bin[d$Maand==4 & d$Dag <= 15] <- 7\nd$Bin[d$Maand==4 & d$Dag > 15] <- 8\nd$Bin[d$Maand==5 & d$Dag <= 15] <- 9\nd$Bin[d$Maand==5 & d$Dag > 15] <- 10\nd$Bin[d$Maand==6 & d$Dag <= 15] <- 11\nd$Bin[d$Maand==6 & d$Dag > 15] <- 12\nd$Bin[d$Maand==7 & d$Dag <= 15] <- 13\nd$Bin[d$Maand==7 & d$Dag > 15] <- 14\nd$Bin[d$Maand==8 & d$Dag <= 15] <- 15\nd$Bin[d$Maand==8 & d$Dag > 15] <- 16\nd$Bin[d$Maand==9 & d$Dag <= 15] <- 17\nd$Bin[d$Maand==9 & d$Dag > 15] <- 18\nd$Bin[d$Maand==10 & d$Dag <= 15] <- 19\nd$Bin[d$Maand==10 & d$Dag > 15] <- 20\nd$Bin[d$Maand==11 & d$Dag <= 15] <- 21\nd$Bin[d$Maand==11 & d$Dag > 15] <- 22\nd$Bin[d$Maand==12 & d$Dag <= 15] <- 23\nd$Bin[d$Maand==12 & d$Dag > 15] <- 24\nd$Bin <- as.factor(d$Bin)\nd$Maand <- as.factor(d$Maand)\nd$Bin <- as.numeric(d$Bin)\n\nd2 <- ddply(d, c(\"Jaar\"), summarise,\n               Afschot   = length(Labelnummer))\n\nd3 <- ddply(d, c(\"Jaar\",\"Bin\"), summarise,\n            Afschotdeel = length(Labelnummer))\n\nd4 <- merge(d2,d3,by=c(\"Jaar\"))\nd4$Aandeel <- (d4$Afschotdeel/d4$Afschot)*100 \n\nd5 <- subset (d4,Jaar==2015)\nd4 <- subset (d4,Jaar!=2015)\n\nd5 <- ddply(d5, c(\"Bin\"), summarise,\n            Jaar2015    = mean(Aandeel))\n\nd4 <- ddply(d4, c(\"Bin\"), summarise,\n            VorigeJaren   = mean(Aandeel),\n            N = length(Aandeel),\n            upper = max(Aandeel),\n            lower = min(Aandeel)\n            )\n\n\nd6 <- merge(d4,d5, by=\"Bin\", all.x=TRUE)\n\nd6$VorigeJaren[d6$Bin==7] <- NA\nd6$VorigeJaren[d6$Bin==8] <- NA\nd6$VorigeJaren[d6$Bin==18] <- NA\nd6$VorigeJaren[d6$Bin==19] <- NA\nd6$VorigeJaren[d6$Bin==20] <- NA\nd6$VorigeJaren[d6$Bin==21] <- NA\nd6$VorigeJaren[d6$Bin==22] <- NA\nd6$VorigeJaren[d6$Bin==23] <- NA\nd6$Jaar2015[d6$Bin==7] <- NA\nd6$Jaar2015[d6$Bin==8] <- NA\nd6$Jaar2015[d6$Bin==18] <- NA\nd6$Jaar2015[d6$Bin==19] <- NA\nd6$Jaar2015[d6$Bin==20] <- NA\nd6$Jaar2015[d6$Bin==21] <- NA\nd6$Jaar2015[d6$Bin==22] <- NA\nd6$Jaar2015[d6$Bin==23] <- NA\nd6$upper[d6$Bin==7] <- NA\nd6$upper[d6$Bin==8] <- NA\nd6$upper[d6$Bin==18] <- NA\nd6$upper[d6$Bin==19] <- NA\nd6$upper[d6$Bin==20] <- NA\nd6$upper[d6$Bin==21] <- NA\nd6$upper[d6$Bin==22] <- NA\nd6$upper[d6$Bin==23] <- NA\nd6$lower[d6$Bin==7] <- NA\nd6$lower[d6$Bin==8] <- NA\nd6$lower[d6$Bin==18] <- NA\nd6$lower[d6$Bin==19] <- NA\nd6$lower[d6$Bin==20] <- NA\nd6$lower[d6$Bin==21] <- NA\nd6$lower[d6$Bin==22] <- NA\nd6$lower[d6$Bin==23] <- NA\nd6$Bin <- as.numeric(d6$Bin)\n\n\np <-\n  ggplot(d6, aes(x=Bin)) +\n  geom_bar(aes(y=VorigeJaren), stat=\"identity\", alpha=1, width=0.75) +\n  geom_point(aes(y=Jaar2015), size=6, colour=\"#688599\") +\n  geom_errorbar(aes(ymax=upper, ymin=lower), colour=\"brown\", width=0.2)+\n  annotate(\"rect\", xmin=0.5 , xmax=6.5, ymin=27, ymax=29, alpha=1, fill=\"grey80\")+\n  geom_text(aes(x= 3.5, y = 28, label = \"geit en kits\"),colour=\"brown\", size=4) +\n  annotate(\"rect\", xmin=8.5, xmax=17.5, ymin=27, ymax=29, alpha=1, fill=\"grey80\")+\n  geom_text(aes(x= 13, y = 28, label = \"bok\"), colour=\"brown\", size=4) +\n  ylab(\"Percentage ree?n in het jaarlijks afschot\") +\n  xlab(NULL) +\n  theme_INBO()+\n  scale_x_continuous(limits=c(0.5,24.5), breaks=c(0.5,2.5,4.5,6.5,8.5,10.5,12.5,14.5,16.5,18.5,20.5,22.5,24.5),\n  labels=c(\"Januari\",\"Februari\",\"Maart\",\"April\",\"Mei\",\"Juni\",\"Juli\",\"Augustus\",\"September\",\"Oktober\",\"November\",\"December\",\"\")) +\n  theme(axis.text.x = element_text(angle=90, hjust=0, vjust=3.5))+\n  coord_cartesian(ylim = c(0, 30))\n\nprint(p)\n\n###Working directory voor opslaan figuren\nsetwd(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Figuren\")\n\n###Figuur###\nggsave(p, file = \"AfschotPerMaand.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(p, file = \"AfschotPerMaand.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\nremove(p)\nremove(d)\nremove(d2)\nremove(d3)\nremove(d4)\nremove(d5)\nremove(d6)\n\n##########################\n########GEWICHT##########\n\n#plot\nGewicht <- subset(Meldingen, Gewicht!=\"NA\")\nGewicht <- subset(Gewicht, Gewicht<30.1)\nGewicht <- subset(Gewicht, Gewicht>4.9)\nGewicht <- subset(Gewicht, Jaar==\"2016\")\n\np <-\n  ggplot(Gewicht, aes(x=Type, y=Gewicht)) + \n  geom_boxplot(width=0.75, colour=INBOreddishbrown, outlier.colour=INBOreddishbrown) + \n  ylab(\"Gewicht (kg)\") +\n  scale_x_discrete(limits=c(\"Geitkits\",\"Bokkits\",\"Jaarlingbok\",\"Smalree\",\"Geit\",\"Bok\"))+\n  scale_y_continuous(breaks=c(5,10,15,20,25)) +\n  theme_INBO()\nprint(p)\n\nsummary(Gewicht$Gewicht~Gewicht$Type)\n\n\n###Figuur###\nggsave(p, file = \"GewichtPerType.jpg\", width = 22.4 /2.54, height = 12 / 2.54, dpi=300)\nggsave(p, file = \"GewichtPerType.eps\", width = 22.4 /2.54, height = 12 / 2.54)\n\nremove(Gewicht)\nremove(p)\n\n\n#######ONDERKAAKLENGTE########\n\nOnderkaak <- Meldingen\nOnderkaak$OKG <- as.numeric(Onderkaak$OKG) \nOnderkaak <- subset(Onderkaak, OKG>100)\nOnderkaak <- subset(Onderkaak, OKG<200)\nOnderkaak <- subset(Onderkaak, Jaar==\"2016\")\n\n###plot\np <-\n  ggplot(Onderkaak, aes(x=Type, y=OKG)) + \n  geom_boxplot(width=0.75, colour=INBOreddishbrown, outlier.colour=INBOreddishbrown) + \n  ylab(\"Onderkaaklengte (mm)\") +\n  scale_x_discrete(limits=c(\"Geitkits\",\"Bokkits\",\"Jaarlingbok\",\"Smalree\",\"Geit\",\"Bok\"))+\n  scale_y_continuous(breaks=c(125,150,175)) +\n  theme_INBO()\nprint(p)\n\nsummary(Onderkaak$OKG~Onderkaak$Type)\n\n###Figuur###\nggsave(p, file = \"OKLPerType.jpg\", width = 22.4 /2.54, height = 12 / 2.54, dpi=300)\nggsave(p, file = \"OKLPerType.eps\", width = 22.4 /2.54, height = 12 / 2.54)\n\nremove(p)\nremove(Onderkaak)\n\n\n#############################\n#Grafiek zwangere dieren#####\n#############################\n\nDRACHT<- read.csv(\"EmbryosOverzicht.csv\", sep=\";\", dec=\",\")\nDRACHT <- subset(MeldingenAll, Type==\"Smalree\"|Type==\"Geit\")\nDRACHT$Jaar <- as.factor(DRACHT$Jaar)\n\nDRACHT$Embryo[DRACHT$TotEmbryo==0] <- 0\nDRACHT$Embryo[DRACHT$TotEmbryo==1] <- 1\nDRACHT$Embryo[DRACHT$TotEmbryo==2] <- 2\nDRACHT$Embryo[DRACHT$TotEmbryo==3] <- 3\nDRACHT$Embryo[is.na(DRACHT$TotEmbryo)] <- \"NIET INGEVULD\"\nDRACHT$Embryo[DRACHT$TotEmbryo>=4] <- \"FOUT\"\nDRACHT <- subset(DRACHT, Embryo!=\"FOUT\")\n\nDRACHT2 <- ddply(DRACHT, c(\"Jaar\",\"Embryo\"), summarise,\n                  Aantal = length(Labelnummer))\n\nDRACHT2b <- subset(DRACHT2, Embryo!=\"NIET INGEVULD\")\nDRACHT2b <- ddply(DRACHT2b, c(\"Jaar\"), summarise,\n                  Totaal = sum(Aantal))\n\nDRACHT2c <- ddply(DRACHT2, c(\"Jaar\"), summarise,\n                  TotaalAantal = sum(Aantal))\n\nDRACHT2 <- merge(DRACHT2,DRACHT2b, by=c(\"Jaar\"))\nDRACHT2 <- merge(DRACHT2,DRACHT2c, by=c(\"Jaar\"))\n\nremove(DRACHT2b)\nremove(DRACHT2c)\nDRACHT2$Percent <- DRACHT2$Aantal/DRACHT2$Totaal*100\nDRACHT2b <- ddply(DRACHT2, c(\"Jaar\"), transform, label_hoogte=cumsum(Aantal))\nDRACHT2b$Label_hoogte_midden <- DRACHT2b$label_hoogte - (DRACHT2b$Aantal/2)\nDRACHT2b$Percent <- ifelse(DRACHT2b$Embryo==\"NIET INGEVULD\",NA,DRACHT2b$Percent)\nDRACHT2b$Embryo[DRACHT2b$Embryo==\"NIET INGEVULD\"] <- \"Niet ingevuld\"\n\n\ncols <- c(\"Niet ingevuld\"=\"grey70\",\"0\"=\"#989868\", \"1\"=\"#688599\", \"2\"=\"#CC3D3D\", \"3\"=\"#EEB600\")\n\np <-\n  ggplot(DRACHT2b, aes(x=Jaar, y=Aantal, fill=Embryo)) + \n  geom_bar(stat=\"identity\", width=0.75) + \n  scale_fill_manual(values=cols) +\n  ylab(\"Aantal vrouwelijke ree?n\") + \n  guides(fill= guide_legend(reverse=TRUE, title=\"Aantal embryo's\")) +\n  geom_text(aes(y = Label_hoogte_midden, label = ifelse(!is.na(Percent),\n                                                        paste(round(Percent, digits = 0), \"%\"),\n                                                        NA)\n                ),colour=\"white\", size=3.5) +\n  geom_text(aes(y = -20, label = TotaalAantal), size=3.5)  +\n  scale_x_discrete(limits=c(\"2007\",\"2008\",\"2009\",\"2010\",\"2011\",\"2012\",\"2013\",\"2014\",\"2015\",\"2016\"))+\n  theme_INBO()\nprint(p)\n\nDRACHT3 <- subset(DRACHT, Embryo!=\"NIET INGEVULD\")\nDRACHT3$Embryo <- as.numeric(DRACHT3$Embryo)\nDRACHT_tabel <- ddply(subset(DRACHT3, Embryo>0), c(\"Jaar\"), summarise,\n                      Aantal=length(Embryo),\n                      Gemiddelde=mean(Embryo, na.rm=TRUE),\n                      sd=sd(Embryo, na.rm=TRUE),\n                      CI=qnorm(0.975)*sd/sqrt(Aantal))\n\n###Figuur###\nggsave(p, file = \"ZwangereDieren.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(p, file = \"ZwangereDieren.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\nremove(p)\nremove(DRACHT)\nremove(DRACHT2)\nremove(cols)\n\n####gIS\n# Haal bestand voor de koppeling met GIS (-> zie bijlage):\nPostcodefile <- Meldingen\nKoppeling <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/deelgemeenten_GIS.csv\",sep=\";\", dec=\",\")\n\n# Probleem: eenzelfde postcode heeft verschillende deelgemeentenamen en bij een koppeling blaast hij dus het aantal records op\n# -> oplossing: per code de fusiegemeente geven:\ndim(sqldf(\"select Koppeling.CODE\n          from Koppeling\n          group by Koppeling.CODE\n          \"))\n\nKoppeling_fusiegemeente <- sqldf(\"select CODE, NAMFGM_k\n                                 from Koppeling i\n                                 where rowid in (select rowid \n                                 from Koppeling\n                                 where CODE = i.CODE\n                                 order by NAMFGM_k ASC limit 1)\n                                 order by i.CODE ASC\n                                 \")\n\n# -> nog problemen door koppelteken\n# -> vervang deze namen in Koppeling_fusiegemeente:\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Dilsen-stokkem\"] <- \"Dilsen-Stokkem\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Hamont-achel\"] <- \"Hamont-Achel\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Hechtel-eksel\"] <- \"Hechtel-Eksel\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Heusden-zolder\"] <- \"Heusden-Zolder\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Houthalen-helchteren\"] <- \"Houthalen-Helchteren\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Meeuwen-gruitrode\"] <- \"Meeuwen-Gruitrode\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Tielt-winge\"] <- \"Tielt-Winge\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Watermaal-bosvoorde\"] <- \"Watermaal-Bosvoorde\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Wezembeek-oppem\"] <- \"Wezembeek-Oppem\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Wortegem-petegem\"] <- \"Wortegem-Petegem\"\n\n\ntemp1 <- merge(Postcodefile, Koppeling_fusiegemeente, by.x = \"PostcodeAfschotLocatie\", by.y = \"CODE\", all.x = TRUE, all.y=F)\ntemp1 <- temp1[-c(15)]\n\ntemp2 <- sqldf(\"select temp1.NAMFGM_k, count(temp1.Labelnummer) as Aantal \n               from temp1\n               group by temp1.NAMFGM_k\n               order by temp1.NAMFGM_k\")\n\nwrite.csv2(temp2, file = \"Afschot_ree_voor_GIS_2014.csv\", row.names = FALSE)\n\n\n###Figuur Verdeling Gemeenten\n\nMeldingen2013PC <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/Meldingen_voorbijejaren_postcode.csv\",sep=\";\", dec=\",\")\nMeldingenPC <- rbind(Meldingen2013PC, Meldingen2014)\nKoppeling <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/deelgemeenten_GIS.csv\",sep=\";\", dec=\",\")\n\n# Probleem: eenzelfde postcode heeft verschillende deelgemeentenamen en bij een koppeling blaast hij dus het aantal records op\n# -> oplossing: per code de fusiegemeente geven:\ndim(sqldf(\"select Koppeling.CODE\n          from Koppeling\n          group by Koppeling.CODE\n          \"))\n\nKoppeling_fusiegemeente <- sqldf(\"select CODE, NAMFGM_k\n                                 from Koppeling i\n                                 where rowid in (select rowid \n                                 from Koppeling\n                                 where CODE = i.CODE\n                                 order by NAMFGM_k ASC limit 1)\n                                 order by i.CODE ASC\n                                 \")\n\n# -> nog problemen door koppelteken\n# -> vervang deze namen in Koppeling_fusiegemeente:\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Dilsen-stokkem\"] <- \"Dilsen-Stokkem\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Hamont-achel\"] <- \"Hamont-Achel\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Hechtel-eksel\"] <- \"Hechtel-Eksel\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Heusden-zolder\"] <- \"Heusden-Zolder\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Houthalen-helchteren\"] <- \"Houthalen-Helchteren\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Meeuwen-gruitrode\"] <- \"Meeuwen-Gruitrode\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Tielt-winge\"] <- \"Tielt-Winge\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Watermaal-bosvoorde\"] <- \"Watermaal-Bosvoorde\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Wezembeek-oppem\"] <- \"Wezembeek-Oppem\"\nKoppeling_fusiegemeente$NAMFGM_k[Koppeling_fusiegemeente$NAMFGM_k==\"Wortegem-petegem\"] <- \"Wortegem-Petegem\"\n\n\ntemp1 <- merge(MeldingenPC, Koppeling_fusiegemeente, by.x = \"PostcodeAfschotLocatie\", by.y = \"CODE\", all.x = TRUE, all.y=F)\ntemp1 <- temp1[-c(15)]\n\ntemp2 <- sqldf(\"select temp1.NAMFGM_k, temp1.Jaar, count(temp1.Labelnummer) as Aantal \n               from temp1\n               group by temp1.NAMFGM_k, Jaar\n               order by temp1.NAMFGM_k, Jaar\")\n##Gemeenten uit Brussel eruit\nKoppeling_fusiegemeente2 <- subset(Koppeling_fusiegemeente, \n                                   NAMFGM_k!=\"Brussel\"\n                                   & NAMFGM_k!=\"Schaarbeek\"\n                                   & NAMFGM_k!=\"Ganshoren\"\n                                   & NAMFGM_k!=\"Jette\"\n                                   & NAMFGM_k!=\"Sint-agatha-berchem\"\n                                   & NAMFGM_k!=\"Koekelberg\"\n                                   & NAMFGM_k!=\"Sint-jans-molenbeek\"\n                                   & NAMFGM_k!=\"Anderlecht\"\n                                   & NAMFGM_k!=\"Sint-gillis\"\n                                   & NAMFGM_k!=\"Vorst\"\n                                   & NAMFGM_k!=\"Oudergem\"\n                                   & NAMFGM_k!=\"Ukkel\"\n                                   & NAMFGM_k!=\"Watermaal-Bosvoorde\"\n                                   & NAMFGM_k!=\"Sint-pieters-woluwe\"\n                                   & NAMFGM_k!=\"Etterbeek\"\n                                   & NAMFGM_k!=\"Sint-lambrechts-woluwe\"\n                                   & NAMFGM_k!=\"Sint-joost-ten-node\"\n                                   & NAMFGM_k!=\"Evere\"\n                                   & NAMFGM_k!=\"Elsene\")\nNAMFGM_k <- unique(Koppeling_fusiegemeente2$NAMFGM_k)\n##blijkbaar ontbreekt Moerbeke\nNAMFGM_k[308]<-\"Moerbeke\"\nJaren <- c(2002:2014)\nGemeenten <- expand.grid(NAMFGM_k, Jaren)\nnames(Gemeenten)[1] <- paste(\"NAMFGM_k\")\nnames(Gemeenten)[2] <- paste(\"Jaar\")\nAantalPerGemeenten <- merge(Gemeenten, temp2, by=c(\"NAMFGM_k\",\"Jaar\"), all.x=TRUE)\nAantalPerGemeenten$Aantal[is.na(AantalPerGemeenten$Aantal)] <- 0\nAantalPerGemeenten$Aantalklasse <- \">30\"\nAantalPerGemeenten$Aantalklasse[AantalPerGemeenten$Aantal<31] <- \"21-30\"\nAantalPerGemeenten$Aantalklasse[AantalPerGemeenten$Aantal<21] <- \"11-20\"\nAantalPerGemeenten$Aantalklasse[AantalPerGemeenten$Aantal<11] <- \"6-10\"\nAantalPerGemeenten$Aantalklasse[AantalPerGemeenten$Aantal<6] <- \"1-5\"\nAantalPerGemeenten$Aantalklasse[AantalPerGemeenten$Aantal==0] <- \"0\"\nAantalPerGemeenten$Aantalklasse<- factor(AantalPerGemeenten$Aantalklasse, levels=c(\"0\",\"1-5\",\"6-10\",\"11-20\",\"21-30\",\">30\"))\ncols <- c(\"white\",\"#FFFF73\",\"#F7BA3E\",\"#D68522\",\"#9E4410\",\"#6B0601\")\n\nggplot(AantalPerGemeenten, aes(x=Aantalklasse, fill=Aantalklasse)) +\n  geom_bar(color=\"black\") +\n  scale_fill_manual(values=cols) +\n  theme_INBO() +\n  facet_wrap(~Jaar, ncol=3) +\n  xlab(\"Aantal geschoten ree?n per gemeente\") +\n  ylab(\"Aantal gemeenten\")\n\ntabelGemeenten <- ddply(AantalPerGemeenten, c(\"Aantalklasse\",\"Jaar\"),\n                        summarise,\n                        Aantal = length(Aantal))\n\nggsave(file = \"VerdelingGemeenten.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(file = \"VerdelingGemeenten.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\nAantalPerGemeenten$Jaar <- factor(AantalPerGemeenten$Jaar)\nAantalPerGemeenten$Totaal<- factor(AantalPerGemeenten$Aantalklasse)\nggplot(AantalPerGemeenten, aes(x=Aantalklasse, order=Jaar, fill=Totaal)) +\n  geom_bar(color=\"grey70\", position=\"dodge\") +\n  scale_fill_manual(values=cols) +\n  theme_INBO() +\n  theme(legend.position=\"bottom\") +\n  labs(fill=\"Aantal ree?n\") +\n  xlab(\"Aantal geschoten ree?n per gemeente voor de periode 2002-2014\") +\n  ylab(\"Aantal gemeenten\")\n\nggsave(file = \"VerdelingGemeenten2.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(file = \"VerdelingGemeenten2.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\n\n##Manier van Thomas\n##Gebruikt color palette RdYlBu maar heeft maar 11 kleuren,\n##Ik neem manueel 6 kleuren en gebruik die dubbel en wit extra\ncols <- c(\"#a50026\",\"#a50026\",\"#f46d43\",\"#f46d43\",\"#fee090\",\"#fee090\",\"white\",\"white\",\n          \"#abd9e9\",\"#abd9e9\",\"#74add1\",\"#74add1\",\"#4575b4\")\n\nggplot(AantalPerGemeenten, aes(x=Aantalklasse, fill=Jaar)) +\n  geom_bar(color=\"grey70\", position=\"dodge\") +\n  scale_fill_manual(values=cols) +\n  theme_INBO() +\n  xlab(\"Aantal ree?n\") +\n  ylab(\"Aantal gemeenten\")\n\nggsave(file = \"VerdelingGemeenten3.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(file = \"VerdelingGemeenten3.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\n\n\nggplot(AantalPerGemeenten, aes(x=Jaar, fill=Totaal)) +\n  geom_bar(color=\"grey90\", position=\"stack\", width=0.7) +\n  scale_fill_manual(values=cols) +\n  theme_INBO() +\n  labs(fill=\"Aantal ree?n\")+\n  ylab(\"Aantal gemeenten\")\n\nggsave(file = \"VerdelingGemeenten3.jpg\", width = 22.4 /2.54, height = 15 / 2.54, dpi=300)\nggsave(file = \"VerdelingGemeenten3.eps\", width = 22.4 /2.54, height = 15 / 2.54)\n\n##Aantal Veranderingen\nVerandering <- subset(AantalPerGemeenten, Jaar==\"2014\" | Jaar==\"2013\")\nVerandering <- cast(Verandering, NAMFGM_k~Jaar)\ntable(Verandering$`2013`,Verandering$`2014`)\n\n\n####Figuur gerealiseerd afschot\nAanvulling_afzonderlijk <- subset(MeldingenAll, Jaar==\"2014\")\nAanvulling_afzonderlijk <- ddply(Aanvulling_afzonderlijk,\n                                 c(\"Registernr\",\"Provincie\",\"Jaar\",\"Type\"), \n                                 summarise, value=length(Labelnummer))\nAanvulling_afzonderlijk2 <- cast(Aanvulling_afzonderlijk,Registernr+Jaar+Provincie~Type, na.rm=TRUE)\n\nAfschot <- subset(MeldingenAll, !is.na(Datum))\nAfschot <- subset(Afschot, Labeltype!=\"\")\n\nggplot(Afschot,aes(x=Jaar, fill=Labeltype)) +\n  geom_bar() + \n  ylab(\"Totaal aantal ree?n aangevraagd\")+\n  theme_INBO() +\n  facet_grid(.~Provincie) +\n  scale_x_discrete(labels=c(2002,\"\",2004,\"\",2006,\"\",2008,\"\",2010,\"\",2012,\"\",2014)) + \n  theme(text = element_text(size=12), axis.text.x = element_text(angle=90, vjust=0.5)) +\n  guides(fill= guide_legend(reverse=TRUE)) +\n  labs(fill=\"Labeltype\")\n\n\n\n########################\n##########EINDE##########\nremove(Meldingen)\nremove(AANVRAAG)\n\n###Meldingen2014 per Faunabeheerzone\nGISUnion <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/Gem_WBE_FZ.csv\",sep=\";\", dec=\",\")\nGISUnion <- as.data.frame(sapply(GISUnion,toupper))\nGISUnion <- subset(GISUnion, Faunabeheerzone>0)\nAfschotplan <- read.csv(\"Q:/OG_Faunabeheer/Projecten/Lopende projecten/INBOPRJ-10218 - Analyse en rapportage van jachtwilddata in Vlaanderen/Grofwild/Ree/Data/Afschotplannen2014.csv\",sep=\";\", dec=\",\")\nAfschotFB <- merge(temp1, Afschotplan, by=\"NummerAfschotplan\", all.x=TRUE)\nAfschotFB <- as.data.frame(sapply(AfschotFB,toupper))\n\nGISUnion$Locatie <- interaction(GISUnion$Gemeente,GISUnion$WBE)\nAfschotFB$Locatie <- interaction(AfschotFB$NAMFGM_k,AfschotFB$WBE)\n\nAfschotFB2 <- unique(AfschotFB$Locatie)\nwrite.csv2(GISUnion, file = \"GISUnion.csv\", row.names = FALSE)\nwrite.csv2(AfschotFB2, file = \"AfschotFB2.csv\", row.names = FALSE)\n\nReeLocatie <- merge(AfschotFB, GISUnion, by=\"Locatie\", all.x=TRUE)\nReeLocatie2 <- ddply(ReeLocatie, c(\"LabelNummer\"), summarise,\n                     Aantal = length(Faunabeheerzone),\n                     FB = max(Faunabeheerzone))\nReeLocatieDubbel <- subset(ReeLocatie2, Aantal>1)\nReeLocatie2 <- subset(ReeLocatie2, Aantal==1)\nReeLocatie2 <- subset(ReeLocatie2, !is.na(FB))\n\n\n###Controle labelnummer en afschotplan\nNummers <- read.csv(\"LabelNummerAfschotplan.csv\",sep=\";\", dec=\",\")\nNummers$ID1 <- substr(Nummers$Afschotplan,1,2)\nNummers$ID2 <- as.numeric(substr(Nummers$Afschotplan,12,14))\nNummers$ID <- paste(Nummers$ID1,Nummers$ID2)\nNummers <- Nummers[-c(8,9)]\nMeldingen2 <- Meldingen[c(8,15,32)]\nMeldingen2$Bron <- substr(Meldingen2$LatestOperationUser,1,1)\nMeldingen2 <-  subset(Meldingen2, Bron==\"G\")\nMeldingen2 <- Meldingen2[c(1,2)]\nMeldingen2$Jaar <- substr(Meldingen2$NummerAfschotplan,7,10)\nMeldingen2 <- subset(Meldingen2, Jaar==\"2014\")\nMeldingen2$Nummer <- substr(Meldingen2$LabelNummer,17,23)\nMeldingen2$Nummer <- as.numeric(Meldingen2$Nummer)\nMeldingen2$Type <- substr(Meldingen2$LabelNummer,13,13)\nMeldingen2$ID1 <- substr(Meldingen2$NummerAfschotplan,1,2)\nMeldingen2$ID2 <- as.numeric(substr(Meldingen2$NummerAfschotplan,12,15))\nMeldingen2$ID <- paste(Meldingen2$ID1,Meldingen2$ID2)\nMeldingen2 <- Meldingen2[-c(3,6,7)]\nMeldingen2 <- merge(Meldingen2, Nummers, by=\"ID\", all.x=TRUE)\nMeldingen2$Controle <- \"FOUT\"\nMeldingen2$ControleGeit[Meldingen2$Nummer>=Meldingen2$Begin.Geit & \n                      Meldingen2$Nummer <= Meldingen2$Eind.Geit] <- \"OK\"\nMeldingen2$ControleBok[Meldingen2$Nummer>=Meldingen2$Begin.Bok & \n                      Meldingen2$Nummer <= Meldingen2$Eind.Bok] <- \"OK\"\nMeldingen2$ControleKits[Meldingen2$Nummer>=Meldingen2$Begin.Kits & \n                      Meldingen2$Nummer <= Meldingen2$Eind.Kits] <- \"OK\"\nMeldingen2$Controle[Meldingen2$ControleGeit==\"OK\"|\n                      Meldingen2$ControleBok==\"OK\"|\n                      Meldingen2$ControleKits==\"OK\"] <- \"OK\"\ntable(Meldingen2$Controle)\nfouten <- subset(Meldingen2, Controle==\"FOUT\")\nwrite.csv(fouten, file=\"FoutenLabelsAfschotplan2014.csv\")\n",
    "created" : 1490694884642.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1025233474",
    "id" : "D8565834",
    "lastKnownWriteTime" : 1490694920,
    "last_content_update" : 1490694920611,
    "path" : "~/GitHub/Ree/Reewild_2017/AnalyseGrofwildRuw_2017.R",
    "project_path" : "AnalyseGrofwildRuw_2017.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}